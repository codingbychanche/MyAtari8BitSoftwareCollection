; ANIMATIONSROTINE/LEGENDE FUER JACK; ;			   						BF'88;-----------------------------------------; Original:			1988; †berarbeite: 		06.05.2016; Original: 		BMEINE.ATR; Original Source:	MAINPRG.SRC ; IDE: ATMASSII (Hofacker);; Every line after this commend remained ; untouched and is written exactly as it; was back in 1988 (except for the adjusted; assembler directives);-----------------------------------------; ;PHASEL	EQU 205 	;BEWEGUNGSPHASE LOW.PHASEH  EQU 206 	;BEWEGUNGSPHASE HI.PHASEL2	EQU 207    	; ''       P2 LOWPHASEH2 EQU 208    	; ''       P2 HIGU 203ADR		EQU 203    	;YPOS.JACK IN GR.13;PMTAB   EQU 18432 PMBASE  EQU 54279HPOSP1  EQU 53248HPOSP2	EQU 53249SDMCTL	EQU 559GPRIOR	EQU 623GRACTL	EQU 53277PLAYER1	EQU PMTAB+1024PLAYER2	EQU PMTAB+1280BRAM 	EQU $A000;STICK0	EQU 632TRIG0	EQU 644;		ORG $A800 	;FREI VERSCHIEBAR.		JMP START;RICHTUNG .byte 0     	;BEWEGUNGSRICHTUNGXPOS	 .byte 45    	;X POSITIONYPOS	 .byte 72    	;Y POSITION ZAELER	 .byte 0     	;16 BYTES GELESEN?PRUEF    .byte 3     	;ZEICHEN DAS VON JACK †BERLAGERT WIRD;TEMP	.byte 0,0     ;TEMPONAEREGISTER.DELAY	.byte 100   	;ZEIT FUER WAIT2STEPNR	.byte 2     	;SCHRITTNUMMER.ZEIT    .byte 255   	;ZEIT-WIELANGE KEINE	    .byte 100   	;HIBYTE ZEIT BEWEGUNG AUSGEFUERT	;; PMGRAFIK VORBEREITEN;START    	LDA #PMTAB/256	STA PMBASE	LDA #58	STA SDMCTL 		LDA XPOS	STA HPOSP1	LDA #3	STA GRACTL	LDA #2	STA GPRIOR;	LDA #8	STA 704	LDA #50	STA 705;	LDX #0CLEAR	LDA #0	STA PLAYER1,X	STA PLAYER2,X	INX	BNE CLEAR;	JSR RECHTS    	;PLAYER DAS 	JSR POKEIN    	;ERSTE MAL	JSR POKEIN2   	;ZEIGEN.;	LDA #<BRAM	STA ADR	LDA #>BRAM	STA ADR+1;; STICKABFRAGE;STICKABF		LDA STICK0	CMP #11	BNE NOT11	LDA #1      	;RICHTUNG=1-LINKS	STA RICHTUNG	JSR LEFT; NOT11		CMP #7	BNE NOT7	LDA #2      	;RICHTUNG=2-RECHTS	STA RICHTUNG 	JSR RIGHT;NOT7		CMP #14    	BNE NOT14	LDA PRUEF   	;IST LEITERTEIL?	CMP #6	BNE NOTA	JSR UPNOTA		CMP #5	BNE NOTB	JSR UPNOTB	CMP #7	BNE NOTC	JSR UPNOTC		CMP #4	BNE NOT14   	;KEINE LEITER.	JSR UP      	;LEITER BESTEIGEN;NOT14		LDA TRIG0   	;JUMP ?	CMP #0	BNE NOT0	JSR JUMP    	;JUMP;NOT0		LDA STICK0	CMP #15     	;KEINE STICKBEWEGUNG	BNE NOT15   	JSR STAND;NOT15		JSR CHECK   	JMP STICKABF;------------------------------------; LINKSBEWEGUNG; PHASE 1;------------------------------------LEFT		JSR CHECKLEFT2		LDA STEPNR    	;SCHON 4    	CMP #0        	;SCHRITTE NACH       	BNE MOVELEFT  	;LINKS?;	LDA #4	STA STEPNR	JSR SBCBRAM 	;BRAM.ADR.-1	JSR LINKS   	;BITMUSTER F.L.MOVELEFT		JSR POKEIN  	;PLAYER 1,	JSR POKEIN2 	;PLAYER 2 EINLESEN	LDX XPOS	DEX	STX XPOS    	;X POS PLAYER 1	STX HPOSP1  	;UND 2 AENDERN.	STX HPOSP2	JSR WAIT	JSR ADC16	JSR ADC162  	;DATAADR.ERHOHEN.;	DEC STEPNR	RTS;------------------------------------; RECHTSBEWEGUNG ; PHASE 1;------------------------------------RIGHT		JSR CHECKRIGHT2		LDA STEPNR	CMP #4	BNE MOVER ;	LDA #0	STA STEPNR	JSR ADDBRAM	JSR RECHTS   	;BITMUSTER F.R.MOVER		JSR POKEIN	JSR POKEIN2	LDX XPOS	INX	STX HPOSP1	STX HPOSP2	STX XPOS	JSR ADC16	JSR ADC162	JSR WAIT	INC STEPNR;	RTS	;------------------------------------; STURZ;------------------------------------STURZ		LDX #0	LDA #<$B220	STA PHASEL	LDA #>$B220	STA PHASEH	LDA #<($B220+128)	STA PHASEL2	LDA #>($B220+128)	STA PHASEH2	LDY YPOS;FALL		LDA DELAY   	;ABFRAGE OB ZU 	CMP #0     		;TIEF GEFALLEN	BNE FALLOK	JMP TOD    		;ZU TIEF=TODFALLOK		STY TEMP		;X UND Y REG 	STX TEMP+1 		;SICHERN.;	JSR POKEIN	JSR POKEIN2	JSR WAIT2   	LDY TEMP	INY	STY YPOS	LDX TEMP+1	INX	DEC DELAY  		;WARTEZEIT-1	DEC DELAY	CPX #8	BNE FALL;	JSR ADC40	JSR CHECK;	LDA #100   		;ENDE STURZ	STA DELAY;		LDA #<$B220	STA PHASEL	LDA #>$B220	STA PHASEH	LDA #<($B220+128)	STA PHASEL2	LDA #>($B220+128)	STA PHASEH2;	LDX #0ENDST		STX TEMP	JSR POKEIN	JSR POKEIN2	JSR ADC16	JSR ADC162		JSR WAIT	LDX TEMP	INX	CPX #4	BNE ENDST	RTS;------------------------------------; JACK AUF LEITER!!;------------------------------------UP		LDX #0	STX TEMP;UPMOVE		LDA #<$B321	STA PHASEL		LDA #>$B321	STA PHASEH	LDA #<($B321+128)	STA PHASEL2	LDA #>($B321+128)	STA PHASEH2;	JSR POKEIN	JSR POKEIN2	JSR ADC16	JSR ADC162	JSR WAIT	JSR POKEIN	JSR POKEIN2	JSR WAIT	LDX YPOS	DEX	DEX	STX YPOS		LDX TEMP	INX	STX TEMP	CPX #4	BNE UPMOVE	JSR SBC40;	LDA #<$B220	STA PHASEL	LDA #>$B220	STA PHASEH	LDA #<($B220+128)	STA PHASEL2	LDA #>($B220+128)	STA PHASEH2	JSR POKEIN	JSR POKEIN2 	RTS;------------------------------------; SPRUNG;------------------------------------JUMP		LDX #0	STX TEMP	LDA #50      	;WARTESCHLEIFE	STA DELAY    	;AUF 50	LDA #<$B220 	;STEHENDEN	STA PHASEL   	;PLAYER ZEIGEN.	LDA #>$B220	STA PHASEH	LDA #<($B220+128)	STA PHASEL2	LDA #>($B220+128)	STA PHASEH2JMPLOOP		LDY YPOS     	;DER EIGENTLICHE	DEY          	;SPRUNG.	STY YPOS     	;YPOS-1	JSR POKEIN   	;PLAYER 1 UND 2	JSR POKEIN2  	;EINPOKEN	JSR WAIT2    	;WARTEN	INC DELAY    	;WARTESHLEIFE 	INC DELAY    	;WENIGER 3.	INC DELAY	LDX TEMP	INX	STX TEMP	CPX #16	BNE JMPLOOP	JSR SBC40     	;BRAM -40	JSR SBC40	JSR CHECK    	;WELCHES ZEICHEN?	RTS	    		;FERTIG.		;------------------------------------; STEHENDEN JACK ZEIGEN; (EINDRUCK DER DREHUNG ERWECKEN);------------------------------------STAND		LDA #<$B220	STA PHASEL	LDA #>$B220	STA PHASEH	LDA #<($B220+128)	STA PHASEL2	LDA #>($B220+128)	STA PHASEH2;	JSR POKEIN       	;STEHENDEN	JSR POKEIN2      	;JACK LESEN.;	DEC ZEIT	LDA ZEIT	CMP #0	        	;ZEIT SCHON 0	BNE RETURN       	;NEIN->RTS;	DEC ZEIT+1       	;HI BYTE ZEIT	LDA ZEIT+1	CMP #0	BEQ WEITER	RETURN		JMP RIGHTLE      	;LINKS ODER	                    ;RECHTS?WEITER		LDA #255	STA ZEIT	LDA #100	STA ZEIT+1;	LDA #<$B3D1	STA PHASEL	LDA #>$B3D1	STA PHASEH	LDA #<($B3D1+128)	STA PHASEL2	LDA #>($B3D1+128)	STA PHASEH2;	LDA #0	STA TEMPTURN		LDA STICK0    	;STICKBEWEGUNG?	CMP #15	BNE RETURN    	;JA->RETURN;	JSR POKEIN	JSR POKEIN2	JSR ADC16	JSR ADC162	JSR WAIT	JSR WAIT	JSR WAIT	INC TEMP	LDA TEMP	CMP #7	BNE TURN		;	LDA YPOS       	;FRAGEZEICHEN	STA TEMP+1     	;AUSGEBEN.	SBC #18	STA YPOS	JSR POKEIN	JSR POKEIN2;W4STICK  	LDA STICK0     ;AUF STICK-	CMP #15        ;BEWEGUNG	BEQ W4STICK    ;WARTEN!!;	LDA #<1536	STA PHASEL	STA PHASEL2	LDA #>1536	STA PHASEH	STA PHASEH2	JSR POKEIN		JSR POKEIN2	LDA TEMP+1     ;RESTORE Y POS.	STA YPOS;RIGHTLE		LDA STICK0	CMP #7         ;RECHTS?	BEQ RECHTS     ;JA!;; UNTERPROGRAMME UM BITMUSTER FUER; JACK RECHTS ODER LINKS ZU STELLEN;LINKS		LDA #<$B000  	STA PHASEL	LDA #>$B000	STA PHASEH	LDA #<($B000+128)	STA PHASEL2	LDA #>($B000+128)	STA PHASEH2	RTS;RECHTS		LDA #<($B000+64)	STA PHASEL	LDA #>($B000+64)	STA PHASEH	LDA #<($B000+192)	STA PHASEL2	LDA #>($B000+192)	STA PHASEH2	RTS	;------------------------------------; TOD!!; PRUEFEN OB GAME OVER;------------------------------------TOD	LDA $14	STA 705	STA 704	STA 706	BNE TOD	RTS;------------------------------------; DIAMANT/GOLD GEFUNDEN;------------------------------------DIAMANT		LDY #0	LDA #30	STA (ADR),Y  	;SCORE AUSGEBEN	INY	LDA #29	STA (ADR),Y	INY	STA (ADR),Y			JMP OLD;GOLD		LDY #0	LDA #28       	;SCORE AUSGEBEN	STA (ADR),Y	INY	LDA #29	STA (ADR),Y	INY	STA (ADR),Y;OLD	JSR WAIT    	;SCORE KURZ	JSR WAIT   		; ZEIGEN.	JSR WAIT    	;(SPATER->SOUND).	LDY #0     		;ALTEN BODENCL	LDA #56     	;WIEDER 	STA (ADR),Y 	;HERSTELLEN.	INY	CPY #3	BNE CL;	LDA #56     	;RESTORE PRUEF.	STA PRUEF	JMP STICKABF;------------------------------------; AB HIER SUBROTINEN:; -POKEIN IN ZEIGT PLAYER 1 AUF SCHIRM; -POKEIN2 ZEIGT PLAYER 2; -ADC16  ERHOET BEWEGUNGSPHASE; -ADC162   ''         ''       PLY.2; -WAIT   WARTESCHLEIFE; -ADDBRAM ADDIERT X POS.JACK IN GR 13; -SBCBRAM SUBTRAHIERT X POS.JACK GR13; -CHECK   WELCHES ZEICHEN WIRD;          UEBERLAGERT?;-------------------------------------POKEIN   	LDX YPOS	LDY #0	LDA #0	STA PLAYER1,X	INXPOKE	LDA (PHASEL),Y	STA PLAYER1,X	INY	INX	INC ZAELER	LDA ZAELER	CMP #16	BNE POKE		LDA #0	STA ZAELER;	CLC        		;LETZTES BYTE	LDA YPOS   		;PLAYER 1 LOESCHEN	ADC #16	TAX	INX	LDA #0	STA PLAYER1,X	RTS;POKEIN2		LDX YPOS	LDY #0	LDA #0	STA PLAYER2,X	INXPOKE2		LDA (PHASEL2),Y	STA PLAYER2,X	INY	INX	INC ZAELER	LDA ZAELER	CMP #16	BNE POKE2	LDA #0	STA ZAELER;	CLC        		;LETZTES BYTE VON	LDA YPOS   		;PLAYER 2 LOESCHEN	ADC #16	TAX	INX	LDA #0	STA PLAYER2,X;	RTS;------------------------------------ADC16		CLC		LDA PHASEL	ADC #16	STA PHASEL	LDA PHASEH	ADC #0	STA PHASEH	RTS		;ADC162		CLC	LDA PHASEL2	ADC #16	STA PHASEL2	LDA PHASEH2	ADC #0	STA PHASEH2	RTS;------------------------------------WAIT		LDX #120LOOP		LDY #120LOOP1		DEY	BNE LOOP1	DEX 	BNE LOOP	RTS;------------------------------------WAIT2		LDX DELAY  	;SPEZIELLE WARTE-LOOP12		LDY DELAY  	;SCHLEIFELOOP22   	DEY        	;DIE WARTEZEIT IST	BNE LOOP22 	;VARIABEL UEBER 	DEX        	;DELAY EINSTELLBAR.	BNE LOOP12	RTS;------------------------------------; ERHOEHEN DES BILDRAMZAELERS;------------------------------------ADDBRAM		CLC	LDY #0	LDA ADR	ADC #1	STA ADR	LDA ADR+1	ADC #0	STA ADR+1	LDA (ADR),Y	STA PRUEF	STA BRAM+38	RTS;------------------------------------; ERNIEDRIGE BILDZAELER;------------------------------------SBCBRAM		LDY #0	LDA ADR	SBC #1	STA ADR	LDA ADR+1	SBC #0	STA ADR+1	LDA (ADR),Y	STA PRUEF	STA BRAM+38	RTS	;-------------------------------------; BILDZAEHLER UM 40 ERHOHEN;-------------------------------------ADC40		CLC	LDY #0	LDA ADR	ADC #40	STA ADR	LDA ADR+1	ADC #0	STA ADR+1	LDA (ADR),Y	STA PRUEF	RTS;------------------------------------; BILDZAHLER UM 40 ERNIEDRIGEN.;------------------------------------SBC40		LDY #0	LDA ADR	SBC #40	STA ADR	LDA ADR+1	SBC #0	STA ADR+1	LDA (ADR),Y	STA PRUEF	RTS;------------------------------------; PRUEFE WELCHES ZEICHEN UEBERLAGERT; WIRD.;------------------------------------CHECK		LDA PRUEF   	;LOCH?	CMP #0	BNE NOSTURZ 	;KEIN LOCH   	JSR STURZ   	;JA JACK SUERZT	JMP STICKABF;NOSTURZ		CMP #1      	;MAUERTEIL LINKS?	BNE NOMLEFT 	;NEIN.	JMP LEFT2   	;JA.	JMP STICKABF;NOMLEFT		CMP #2      	;MAUERTEIL RECHTS?	BNE NMRIGHT 	;NEIN.	JMP RIGHT2  	;JA.	JMP STICKABF;NMRIGHT		CMP #72     	;WIRD EIN ZEICHEN	BNE NOT72   	;DAS TOEDLICH	JMP TOD    		;WIRKT UEBER-NOT72		CMP #119    	;LAGERT?	BNE NOT19   	JMP TOD;NOT19		CMP #27     	;DIAMANT ODER 	BNE NOT27   	;GOLD?	JMP DIAMANTNOT27		CMP #57	BNE NOT57	JMP GOLD;NOT57	RTS