mads 1.9.3
     1 				; LEVELEDITOR FUER LEGENDE
     2 				; 
     3 				;			   						BF'88
     4 				;-----------------------------------------
     5 				; Original:			1988
     6 				; †berarbeite: 		13.6.2014
     7 				; Original: 		EMEINE.ATR
     8 				; Original Source:	LVLEDIT.SRC 
     9 				; IDE: ATMASSII (Hofacker)
    10 				;
    11 				; Every line after this commend remained 
    12 				; untouched and is written exactly as it
    13 				; was back in 1988 (except for the adjusted
    14 				; assembler directives)
    15 				;-----------------------------------------
    16 				; 
    17 = 0230			SDLISTL	EQU 560
    18 = 022F			SDMCTL	EQU 559
    19 = 0200			VDLIST	EQU 512
    20 = D40E			NMIEN	EQU 54286
    21 = D01F			CONSOL	EQU 53279
    22 = 0278			STICK0	EQU 632
    23 = 0284			TRIG	EQU 644
    24 = 4C00			PMTAB	EQU 19456
    25 = 4E00			PLAYER1	EQU PMTAB+512
    26 = 4E80			PLAYER2	EQU PMTAB+640
    27 = 4F00			PLAYER3	EQU PMTAB+768
    28 = 4F80			PLAYER4	EQU PMTAB+896
    29 = 00CF			BRAMADRL	EQU 207       	;BRAMADR LOW
    30 = 00D0			BRAMADRH	EQU 208	      	; ''    HI
    31 = B550			GR12RAM	EQU $B550
    32 = 0304			DBUFLO	EQU 772   			;BUFFER LOW 
    33 = 0305			DBUFHI	EQU 773   			;BUFFER HI
    34 = 030A			DAUX1	EQU 778   			;SEKTORNUMMER LOW
    35 = 030B			DAUX2	EQU 779   			;SEKTORNUMMER HI
    36 = 0302			DCOMND	EQU 770	 			;KOMMANDO
    37 = E453			DSKINV	EQU 58451 			;IO ROTINE
    38 				;
    39 				; DLIST UND INHALT
    40 				;----------------------------------
    41 					ORG $A800
    42 FFFF> A800-AF8D> 4C 54 + 	JMP START
    43 				;
    44 A803 00 00 33 30 29 25 + TITLE	.byte "  SPIELFELD-EDITOR  "
    45
    46 A817 2F 72 67 69 6E 61 + STATUS	.byte "Orginal:    |Zeile:       |Spalte:      "
    47 A83F 23 2C 32 7C 23 28 + 		.byte "CLR|CH1|CH2|CO1|CO2|CO3|CO4|LOD|SAV|END "
    48 				;
    49 A867 26 61 72 62 65 6E + COLTXT	.byte "Farben aendern|Helligkeit<=STICK=>Farbe "
    50 A88F 33 74 69 63 6B 00 + 		.byte "Stick nach unten=>ABRUCH                "
    51 				;
    52 A8B7 37 65 6C 63 68 65 + IOSCR	.byte "Welcher Level?|Level+1 <=STICK=>Level-1 "
    53 A8DF 2C 65 76 65 6C 00 + 		.byte "Level Nr.:    |Trigger wenn fertig.     "
    54 				;
    55 				;
    56 A907 00 00 3A 35 27 32 + SAVSCR	.byte "  ZUGRIFF AUF DISK  "
    57 A91B 00 25 29 2E 25 2E + 		.byte " EINEN MOMENT BITTE "
    58 				;
    59 A92F 00 00 30 2C 21 39 + TTITLE	.byte "  PLAYFIELD-EDITOR  "
    60 A943 00 00 00 00 00 00 + 		.byte "                    "
    61 A957 00 00 00 00 2C 25 + 		.byte "    LEGENDE DISK    "
    62 A96B 00 00 00 00 00 00 + 		.byte "      EINLEGEN      "
    63 A97F 00 00 00 00 00 35 + 		.byte "     UND TRIGER     "	
    64 				;
    65 A993 10 10 10 11 10 12 + NUMMER	.byte "0001020304050607080910"
    66 A9A9 11 11 11 12 11 13 + 		.byte "11121314151617181920"
    67 A9BD 12 11 12 12 12 13 + 		.byte "2122232425262728293031323334353637383940"
    68 				;
    69 A9E5			OBJEKT
    70 A9E5 E0				.byte %11100000
    71 A9E6 C0				.byte %11000000
    72 A9E7 A0				.byte %10100000
    73 A9E8 10				.byte %00010000
    74 				;
    75 A9E9			KLAMMER	
    76 A9E9 7C				.byte %1111100
    77 A9EA 45				.byte %1000101
    78 A9EB 55				.byte %1010101
    79 A9EC 55				.byte %1010101
    80 A9ED 55				.byte %1010101
    81 A9EE 55				.byte %1010101	
    82 A9EF 55				.byte %1010101
    83 A9F0 55				.byte %1010101
    84 A9F1 49				.byte %1001001
    85 A9F2 22				.byte %0100010
    86 A9F3 14				.byte %0010100
    87 A9F4 08				.byte %0001000 
    88 				;
    89 				; VARIABLES
    90 				;-----------------------------------
    91 A9F5 00			OLD		.byte 0
    92 A9F6			FUNKTION	
    93 A9F6 00					.byte 0
    94 A9F7			XPOS	
    95 A9F7 00					.byte 0
    96 A9F8			YPOS	
    97 A9F8 01					.byte 1
    98 A9F9 31			X		.byte 49 		;X POS PLAYER
    99 A9FA 1D			Y		.byte 29 		;Y POS PLAYER
   100 A9FB 01			ORGINAL	.byte 1  		;ORGINAL ZEICHEN
   101 A9FC 10			COLOR0	.byte 16  		;COLPF1-COLBK
   102 A9FD 0E			COLOR1	.byte 14
   103 A9FE 14			COLOR2	.byte 20
   104 A9FF 0A			COLOR3	.byte 10
   105 AA00 38			COLOR4	.byte 56
   106 AA01 00 00		BUFFER	.byte 0,0 		;BUFFER
   107 AA03 00			BRAMEND	.byte 0  		;ENDE BILDRAM
   108 AA04 00			XSEG	.byte 0
   109 AA05			XSEGMENT	
   110 AA05 00					.byte 0
   111 AA06 01			LEVEL	.byte 1  		;NR DES JEWEILIGEN LEV.
   112 AA07			SEKTOREN	
   113 AA07 01					.byte 1  		;GESCHRIEBENE SEKTOREN
   114 AA08 00			COMMAND	.byte 0
   115 AA09 B0			CHAR	.byte $B000/256	;ZEICHENSATZ
   116 				;
   117 				; TABELLE DER SEKTOREN LOW+HIGH
   118 				;-----------------------------------
   119 AA0A A5 CE F7 20		SEKTORL 	.byte <421,<462,<503,<544
   120 AA0E 49 72					.byte <585,<626
   121 AA10 01 01 01 02		SEKTORH		.byte >421,>462,>503,>544
   122 AA14 02 02					.byte >585,>626
   123 				;
   124 				; DISPLAYLIST.
   125 				;-----------------------------------
   126 AA16			DLIST	
   127 AA16 70 70			.byte 112,112
   128 AA18 46				.byte 6+64
   129 AA19 03 A8			.word TITLE
   130 AA1B A0				.byte $A0
   131 AA1C C2				.byte 2+64+128
   132 AA1D 17 A8		RAM	.word STATUS
   133 AA1F A0				.byte $A0
   134 AA20 82				.byte 2+128
   135 AA21 A0				.byte $A0
   136 AA22 44				.byte 4+64
   137 AA23 50 B5			.word $B550  
   138 AA25 04 04 04 04 04 04 + 	.byte 4,4,4,4,4,4,4,4,4,4,4
   139 AA30 04 04 04 84			.byte 4,4,4,4+128
   140 AA34 05 05 85			.byte 5,5,5+128
   141 AA37 70				.byte 112
   142 AA38 41				.byte 65
   143 AA39 16 AA			.word DLIST
   144 				;
   145 AA3B			BLANKLST	
   146 AA3B 70 70 70 70 70		.byte 112,112,112,112,112
   147 AA40 47				.byte 7+64
   148 AA41 07 A9			.word SAVSCR
   149 AA43 07				.byte 7
   150 AA44 41				.byte 65
   151 AA45 3B AA			.word BLANKLST
   152 				;
   153 AA47			TTLIST	
   154 AA47 70 70 70			.byte 112,112,112
   155 AA4A 47				.byte 64+7
   156 AA4B 2F A9			.word TTITLE
   157 AA4D 07 07 07 07			.byte 7,7,7,7
   158 AA51 41				.byte 65
   159 AA52 47 AA			.word TTLIST
   160 				;
   161 				; PROGRAMBEGINN  DLIST AKTIVIEREN
   162 				;------------------------------------
   163 AA54			START	
   164 AA54 A9 47			LDA #<TTLIST
   165 AA56 8D 30 02			STA SDLISTL
   166 AA59 A9 AA			LDA #>TTLIST
   167 AA5B 8D 31 02			STA SDLISTL+1
   168 				;
   169 AA5E			WARTE	
   170 AA5E AD 84 02			LDA TRIG
   171 AA61 D0 FB			BNE WARTE
   172 				;
   173 AA63 A9 16			LDA #<DLIST
   174 AA65 8D 30 02			STA SDLISTL
   175 AA68 A9 AA			LDA #>DLIST
   176 AA6A 8D 31 02			STA SDLISTL+1
   177 					
   178 				; DLI AKTIVIEREN
   179
   180 AA6D A9 C1			LDA #<DLI1
   181 AA6F 8D 00 02			STA DLIVKTL
   182 AA72 A9 AE			LDA #>DLI1
   183 AA74 8D 01 02			STA DLIVKTH
   184 AA77 A9 C0			LDA #192
   185 AA79 8D 0E D4			STA 54286
   186 				; ZEICHEN ZUR AUSWAHL EINPOKEN
   187 AA7C A2 00			LDX #0
   188 AA7E 8A			CHR	TXA
   189 AA7F 9D D0 B7			STA GR12RAM+677-37,X
   190 AA82 E8				INX
   191 AA83 E0 80			CPX #128
   192 AA85 D0 F7			BNE CHR
   193 				; PM GRAFIK
   194 AA87 A9 4C			LDA #PMTAB/256
   195 AA89 8D 07 D4			STA 54279
   196 AA8C A9 2E			LDA #46
   197 AA8E 8D 2F 02			STA SDMCTL
   198 AA91 A9 03			LDA #3
   199 AA93 8D 1D D0			STA 53277
   200 AA96 A9 10			LDA #16
   201 AA98 8D 6F 02			STA 623
   202 				; ALLE PM OBJEKTE WEG.
   203 AA9B A2 00			LDX #0
   204 AA9D			PWEG	
   205 AA9D A9 00			LDA #0
   206 AA9F 9D 00 4E			STA PLAYER1,X
   207 AAA2 9D 80 4E			STA PLAYER2,X
   208 AAA5 9D 00 4F			STA PLAYER3,X
   209 AAA8 9D 80 4F			STA PLAYER4,X
   210 AAAB E8				INX
   211 AAAC E0 FF			CPX #255
   212 AAAE D0 ED			BNE PWEG
   213 				; PMGRAFIK EINLESEN
   214 AAB0 20 55 AE			JSR PMWEG
   215 AAB3 20 43 AE			JSR READ
   216 				; PLAYER 2
   217 AAB6 A2 00			LDX #0
   218 AAB8 A0 0A			LDY #10
   219 AABA BD E9 A9		PL2	LDA KLAMMER,X
   220 AABD 99 80 4E			STA PLAYER2,Y
   221 AAC0 C8				INY
   222 AAC1 E8				INX
   223 AAC2 E0 0C			CPX #12
   224 AAC4 D0 F4			BNE PL2
   225 				; PLAYER 3
   226 AAC6 A2 00			LDX #0
   227 AAC8 A0 0F			LDY #15
   228 AACA A9 FF		PL3	LDA #255
   229 AACC 99 00 4F			STA PLAYER3,Y
   230 AACF 99 80 4F			STA PLAYER4,Y
   231 AAD2 C8				INY
   232 AAD3 E8				INX
   233 AAD4 E0 64			CPX #100
   234 AAD6 D0 F2			BNE PL3
   235 				; PM OBJ. POSITIONIEREN
   236 AAD8 AD F9 A9			LDA X
   237 AADB A9 01			LDA #1
   238 AADD 8D 0A D0			STA 53258
   239 AAE0 8D 00 D0			STA 53248
   240 AAE3 A9 D0			LDA #208
   241 AAE5 8D 01 D0			STA 53249
   242 AAE8 8D 02 D0			STA 53250
   243 AAEB A9 28			LDA #40
   244 AAED 8D 03 D0			STA 53251
   245 AAF0 A9 FF			LDA #255
   246 AAF2 8D C0 02			STA 704
   247 AAF5 A9 0A			LDA #10
   248 AAF7 8D C1 02			STA 705
   249 AAFA A9 00			LDA #0
   250 AAFC 8D C3 02			STA 707
   251 				; BILDRAMADR EINTRAGEN
   252 AAFF A9 50			LDA #<GR12RAM
   253 AB01 85 CF			STA BRAMADRL
   254 AB03 A9 B5			LDA #>GR12RAM
   255 AB05 85 D0			STA BRAMADRH
   256 					;LDA #>GR12RAM+812
   257 AB07 8D 03 AA			STA BRAMEND
   258 				; TASTAURKLICKEN AUS
   259 AB0A A9 FF			LDA #255
   260 AB0C 8D DF 02			STA 735
   261 AB0F A9 52			LDA #'R'
   262 AB11 8D 08 AA			STA COMMAND
   263 AB14 4C 7B AD			JMP IO
   264 				;
   265 				; STICKABFRAGE
   266 				;------------------------------------
   267 AB17 20 F9 AD			JSR OUTPUT   			;X/YPOS C.AUSGEBEN
   268 				; STICK WIRD ABGEFRAGT
   269 AB1A			STICK	
   270 AB1A AD 78 02			LDA STICK0
   271 AB1D C9 07			CMP #7
   272 AB1F D0 03			BNE NOT7
   273 AB21 20 93 AB			JSR RECHTS
   274 AB24			NOT7	
   275 AB24 C9 0B			CMP #11
   276 AB26 D0 03			BNE NOT11
   277 AB28 20 B6 AB			JSR LINKS
   278 AB2B			NOT11	
   279 AB2B C9 0D			CMP #13
   280 AB2D D0 03			BNE NOT13
   281 AB2F 20 D9 AB			JSR RUNTER
   282 AB32			NOT13	
   283 AB32 C9 0E			CMP #14
   284 AB34 D0 03			BNE NOT14
   285 AB36 20 FF AB			JSR RAUF
   286 AB39			NOT14	
   287 AB39 C9 0A			CMP #10
   288 AB3B D0 06			BNE NOT10
   289 AB3D 20 FF AB			JSR RAUF
   290 AB40 20 B6 AB			JSR LINKS
   291 AB43			NOT10	
   292 AB43 C9 06			CMP #6
   293 AB45 D0 06			BNE NOTD6
   294 AB47 20 FF AB			JSR RAUF
   295 AB4A 20 93 AB			JSR RECHTS
   296 AB4D			NOTD6	
   297 AB4D C9 09			CMP #9
   298 AB4F D0 06			BNE NOT9
   299 AB51 20 D9 AB			JSR RUNTER
   300 AB54 20 B6 AB			JSR LINKS
   301 AB57			NOT9	
   302 AB57 C9 05			CMP #5
   303 AB59 D0 06			BNE NOTD5
   304 AB5B 20 D9 AB			JSR RUNTER
   305 AB5E 20 93 AB			JSR RECHTS
   306 AB61			NOTD5	
   307 AB61 AD 84 02			LDA TRIG
   308 AB64 C9 00			CMP #0
   309 AB66 D0 03			BNE NOTRIG
   310 AB68 20 6E AB			JSR TRIGGER
   311 AB6B			NOTRIG	
   312 AB6B 4C 1A AB			JMP STICK
   313 				;
   314 				; STICKBEFHELE AUSFUEREN.
   315 				;------------------------------------
   316 AB6E			TRIGGER	
   317 AB6E AD F8 A9			LDA YPOS       		;YPOS>18?
   318 AB71 C9 11			CMP #17
   319 AB73 B0 13			BCS HOLZEICH   		;JA Z.HOLEN
   320
   321 AB75 AD F8 A9			LDA YPOS       		;XPOS>40
   322 AB78 C9 00			CMP #0         		;FUNKTION
   323 AB7A D0 04			BNE PLOT       		;<40=PLOT 
   324 AB7C 20 24 AC			JSR STARTK     		;AUSFUHREN.
   325 AB7F 60				RTS
   326 				;
   327 AB80			PLOT	
   328 AB80 A0 00			LDY #0         		;YPOS<18=PLOT
   329 AB82 AD FB A9			LDA ORGINAL      	;ZEICHEN
   330 AB85 91 CF			STA (BRAMADRL),Y 	;PLOTEN.
   331 AB87 60				RTS
   332 				;
   333 AB88			HOLZEICH	
   334 AB88 A0 00			LDY #0
   335 AB8A B1 CF			LDA (BRAMADRL),Y
   336 AB8C 8D FB A9			STA ORGINAL
   337 AB8F 20 F9 AD			JSR OUTPUT
   338 AB92 60				RTS
   339 				;
   340 AB93			RECHTS	
   341 AB93 AD F7 A9			LDA XPOS
   342 AB96 C9 27			CMP #39
   343 AB98 D0 03			BNE NOT39
   344 AB9A 4C 1A AB			JMP STICK
   345 				;
   346 AB9D			NOT39	
   347 AB9D EE F7 A9			INC XPOS   			;XPOS ERHOHEN
   348 ABA0 20 F9 AD			JSR OUTPUT 			;WERT AUSGABE
   349 ABA3 20 38 AE			JSR WAIT
   350 				;	
   351 ABA6 18				CLC        			;CURSOR 4 BIT 
   352 ABA7 AD F9 A9			LDA X	  			;RECHTS.
   353 ABAA 69 04			ADC #4
   354 ABAC 8D 00 D0			STA 53248
   355 ABAF 8D F9 A9			STA X	
   356 ABB2 20 7E AE			JSR ADC1   			;BRAM+1
   357 ABB5 60				RTS
   358 				; LINKS
   359 ABB6			LINKS	
   360 ABB6 AD F7 A9			LDA XPOS
   361 ABB9 C9 00			CMP #0
   362 ABBB D0 03			BNE NOT0
   363 ABBD 4C 1A AB			JMP STICK
   364 				;
   365 ABC0			NOT0	
   366 ABC0 CE F7 A9			DEC XPOS
   367 ABC3 20 F9 AD			JSR OUTPUT
   368 ABC6 20 38 AE			JSR WAIT
   369 				;
   370 ABC9 38				SEC
   371 ABCA AD F9 A9			LDA X      			;CURSOR 4 BIT
   372 ABCD E9 04			SBC #4    			;LINKS
   373 ABCF 8D 00 D0			STA 53248
   374 ABD2 8D F9 A9			STA X    		
   375 ABD5 20 8C AE			JSR SBC1   			;BRAMADR-1
   376 ABD8 60				RTS
   377 				; RUNTER
   378 ABD9			RUNTER	
   379 ABD9 AD F8 A9			LDA YPOS
   380 ABDC C9 14			CMP #20
   381 ABDE D0 03			BNE NOT20
   382 ABE0 4C 1A AB			JMP STICK
   383 				;
   384 ABE3			NOT20	
   385 ABE3 EE F8 A9			INC YPOS 
   386 ABE6 20 F9 AD			JSR OUTPUT
   387 ABE9 20 38 AE			JSR WAIT
   388 				;
   389 ABEC 20 55 AE			JSR PMWEG   		;ALTES PM CLEAR
   390 ABEF 18				CLC	   				;CURSOR 8 BIT RUN-
   391 ABF0 AD FA A9			LDA Y       		;TER.
   392 ABF3 69 04			ADC #4
   393 ABF5 8D FA A9			STA Y
   394 ABF8 20 43 AE			JSR READ
   395 ABFB 20 62 AE			JSR ADC40   		;BRAMADR+40
   396 ABFE 60				RTS
   397 				; RAUF
   398 ABFF			RAUF	
   399 ABFF AD F8 A9			LDA YPOS
   400 AC02 C9 00			CMP #0
   401 AC04 D0 03			BNE NOT02
   402 AC06 4C 1A AB			JMP STICK
   403 				;
   404 AC09			NOT02	
   405 AC09 CE F8 A9			DEC YPOS
   406 AC0C 20 F9 AD			JSR OUTPUT
   407 AC0F 20 38 AE			JSR WAIT
   408 				;
   409 AC12 20 55 AE			JSR PMWEG   		;ALTES PM CLEAR
   410 AC15 AD FA A9			LDA Y      			;CURSOR 8 BIT
   411 AC18 E9 04			SBC #4      		;NACH OBEN
   412 AC1A 8D FA A9			STA Y
   413 AC1D 20 43 AE			JSR READ
   414 AC20 20 70 AE			JSR SBC40   		;BRAMADR-40
   415 AC23 60				RTS
   416 				;
   417 				; POSITION MAUSZEIGER IN MENLINE 
   418 				; ERMITTELN
   419 				;------------------------------------
   420 AC24			STARTK	
   421 AC24 A9 01			LDA #1
   422 AC26 8D F6 A9			STA FUNKTION
   423 AC29 A9 00			LDA #0
   424 AC2B 8D 05 AA			STA XSEGMENT
   425 AC2E 8D 04 AA			STA XSEG
   426 AC31			SEARCH	
   427 AC31 AD 05 AA			LDA XSEGMENT
   428 AC34 EE 04 AA			INC XSEG
   429 AC37 EE 05 AA			INC XSEGMENT
   430 AC3A CD F7 A9			CMP XPOS
   431 AC3D D0 03			BNE NOXPOS
   432 AC3F 4C 5C AC			JMP FOUND
   433 AC42			NOXPOS	
   434 AC42 AD 04 AA			LDA XSEG 
   435 AC45 C9 04			CMP #4
   436 AC47 D0 E8			BNE SEARCH	
   437 AC49 A9 00			LDA #0
   438 AC4B 8D 04 AA			STA XSEG
   439 AC4E AD F6 A9			LDA FUNKTION
   440 AC51 C9 0B			CMP #11
   441 AC53 D0 01			BNE NO11
   442 AC55 60				RTS
   443 AC56			NO11	
   444 AC56 EE F6 A9			INC FUNKTION
   445 AC59 4C 31 AC			JMP SEARCH
   446 				;
   447 				; XPOSITION GEFUNDEN 
   448 				; (WAS SOLL GETHAN WERDEN ?)
   449 				;------------------------------------
   450 AC5C			FOUND	
   451 AC5C AD F6 A9			LDA FUNKTION
   452 AC5F C9 01			CMP #1
   453 AC61 D0 04			BNE NOT1
   454 AC63 20 BB AC			JSR CLEARSCR
   455 AC66 60				RTS
   456 				;
   457 AC67			NOT1	
   458 AC67 C9 04			CMP #4
   459 AC69 D0 06			BNE NOT4
   460 AC6B A2 00			LDX #0      		;XREG=FARBNUMMER
   461 AC6D 20 EA AC			JSR COLOR
   462 AC70 60				RTS
   463 				;
   464 AC71			NOT4	
   465 AC71 C9 05			CMP #5
   466 AC73 D0 06			BNE NOT5
   467 AC75 A2 01			LDX #1
   468 AC77 20 EA AC			JSR COLOR
   469 AC7A 60				RTS
   470 				;
   471 AC7B			NOT5	
   472 AC7B C9 06			CMP #6
   473 AC7D D0 06			BNE NOT6
   474 AC7F A2 02			LDX #2
   475 AC81 20 EA AC			JSR COLOR
   476 AC84 60				RTS
   477 				;
   478 AC85			NOT6	
   479 AC85 C9 07			CMP #7
   480 AC87 D0 05			BNE NOT07
   481 AC89 A2 04			LDX #4
   482 AC8B 20 EA AC			JSR COLOR
   483 				;
   484 AC8E C9 08		NOT07	CMP #8
   485 AC90 D0 08			BNE NOT8
   486 AC92 A9 52			LDA #'R'      		;DATA READ
   487 AC94 8D 08 AA			STA COMMAND
   488 AC97 4C 30 AD			JMP AUSWAHL
   489 				;
   490 AC9A			NOT8	
   491 AC9A C9 09			CMP #9
   492 AC9C D0 08			BNE NOT09
   493 AC9E A9 57			LDA #'W'      		;DATA WRITE
   494 ACA0 8D 08 AA			STA COMMAND
   495 ACA3 4C 30 AD			JMP AUSWAHL
   496 				;
   497 ACA6			NOT09	
   498 ACA6 C9 02			CMP #2
   499 ACA8 D0 06			BNE NOT2
   500 ACAA A9 B4			LDA #>$B400
   501 ACAC 8D 09 AA			STA CHAR
   502 ACAF 60				RTS
   503 				;
   504 ACB0			NOT2	
   505 ACB0 C9 03			CMP #3
   506 ACB2 D0 06			BNE NOT3
   507 ACB4 A9 B0			LDA #>$B000
   508 ACB6 8D 09 AA			STA CHAR
   509 ACB9 60				RTS
   510 				;
   511 ACBA			NOT3	
   512 ACBA 60				RTS 
   513 				;
   514 				; BILDSCHIRM LOESCHEN
   515 				;------------------------------------
   516 ACBB			CLEARSCR	
   517 ACBB A0 00			LDY #0
   518 ACBD A2 00			LDX #0
   519 ACBF A5 CF			LDA BRAMADRL  			;HI UND LOW
   520 ACC1 8D 01 AA			STA BUFFER    			;BYTE DER BILD
   521 ACC4 A5 D0			LDA BRAMADRH  			;ADRESSE SICHERN
   522 ACC6 8D 02 AA			STA BUFFER+1
   523 				;
   524 ACC9 A9 50			LDA #<GR12RAM			;ZEIGER AUF 
   525 ACCB 85 CF			STA BRAMADRL   			;BRAM ZUREUCK-
   526 ACCD A9 B5			LDA #>GR12RAM			;SETZEN.
   527 ACCF 85 D0			STA BRAMADRH
   528 				;
   529 ACD1			LOESCHB	
   530 ACD1 A9 00			LDA #0
   531 ACD3 91 CF			STA (BRAMADRL),Y
   532 ACD5 20 7E AE			JSR ADC1       			;BRAMADR+1
   533 ACD8 A5 D0			LDA BRAMADRH
   534 ACDA CD 03 AA			CMP BRAMEND    			;ENDE?
   535 ACDD D0 F2			BNE LOESCHB
   536 				;
   537 ACDF AD 01 AA			LDA BUFFER   			;ZEIGER AUF BRAM
   538 ACE2 85 CF			STA BRAMADRL 			;RESTAURIEREN.
   539 ACE4 AD 02 AA			LDA BUFFER+1
   540 ACE7 85 D0			STA BRAMADRH
   541 ACE9 60				RTS
   542 				;
   543 				; FARBE AENDERN
   544 				;------------------------------------
   545 ACEA			COLOR 	
   546 ACEA A9 67			LDA #<COLTXT  			;HILFSTEXT
   547 ACEC 8D 1D AA			STA RAM        			;AUSGEBEN
   548 ACEF A9 A8			LDA #>COLTXT
   549 ACF1 8D 1E AA			STA RAM+1
   550 				;
   551 ACF4			COLOP	
   552 ACF4 8E 01 AA			STX BUFFER     			;X REG.SICHERN
   553 ACF7 20 38 AE			JSR WAIT       			;PAUSE
   554 ACFA AE 01 AA			LDX BUFFER     			;X REG. RESTORE
   555 ACFD AD 78 02			LDA STICK0     			;STICKABFRAGE
   556 AD00 C9 07			CMP #7	      			;RECHTS?
   557 AD02 D0 06			BNE NORIGHT    			;NEIN
   558 AD04 FE FC A9			INC COLOR0,X   			;JA HELLIGKEIT.
   559 AD07 4C 2D AD			JMP NUNT       			;WEITER
   560 AD0A			NORIGHT	
   561 AD0A C9 0B			CMP #11        			;LINKS?
   562 AD0C D0 0B			BNE NOLEFT     			;NEIN
   563 AD0E BD FC A9			LDA COLOR0,X   			;JA FARBWERT
   564 AD11 69 10			ADC #16        			;ERHOHEN
   565 AD13 9D FC A9			STA COLOR0,X
   566 AD16 4C 2D AD			JMP NUNT
   567 AD19			NOLEFT	
   568 AD19 C9 0D			CMP #13       			;STICK UNTEN
   569 AD1B D0 10			BNE NUNT      			;NEIN
   570 AD1D A9 17			LDA #<STATUS 			;JA ENDE.
   571 AD1F 8D 1D AA			STA RAM      			;MENUEZEILE
   572 AD22 A9 A8			LDA #>STATUS 			;WIEDER EIN-
   573 AD24 8D 1E AA			STA RAM+1     			;BLENDEN.
   574 AD27 20 D9 AB			JSR RUNTER    			;CURSOR RUNTER.
   575 AD2A 4C 1A AB			JMP STICK     			;RETURN.
   576 AD2D			NUNT	
   577 AD2D 4C F4 AC			JMP COLOP     			;WEITERMACHEN.
   578 				;
   579 				; AUSWAHL WELCHER LEVEL GESAVT WERDEN
   580 				; SOLL.
   581 				;------------------------------------
   582 AD30			AUSWAHL	
   583 AD30 A9 B7			LDA #<IOSCR  			;HILFSTEXT
   584 AD32 8D 1D AA			STA RAM       			;AM BILDRAM
   585 AD35 A9 A8			LDA #>IOSCR				;EINBLENDEN.
   586 AD37 8D 1E AA			STA RAM+1
   587 				;
   588 AD3A			LEVELWAL	
   589 AD3A 20 38 AE			JSR WAIT      			;WARTEN
   590 AD3D AD 78 02			LDA STICK0
   591 AD40 C9 07			CMP #7
   592 AD42 D0 10			BNE INCLEV
   593 				;
   594 AD44 AD 06 AA			LDA LEVEL 
   595 AD47 C9 02			CMP #2
   596 AD49 90 09			BCC INCLEV
   597 AD4B CE 06 AA			DEC LEVEL
   598 AD4E 20 F9 AD			JSR OUTPUT    			;AUSGABE
   599 AD51 4C 3A AD			JMP LEVELWAL
   600 				;
   601 AD54			INCLEV	
   602 AD54 C9 0B			CMP #11
   603 AD56 D0 10			BNE NOINC
   604 				;
   605 AD58 AD 06 AA			LDA LEVEL
   606 AD5B C9 06			CMP #6
   607 AD5D B0 09			BCS NOINC
   608 AD5F EE 06 AA			INC LEVEL
   609 AD62 20 F9 AD			JSR OUTPUT    			;AUSGABE
   610 AD65 4C 3A AD			JMP LEVELWAL
   611 				;
   612 AD68			NOINC	
   613 AD68 20 38 AE			JSR WAIT
   614 AD6B 20 38 AE			JSR WAIT
   615 AD6E AD 84 02			LDA TRIG
   616 AD71 C9 00			CMP #0
   617 AD73 D0 03			BNE NOEND
   618 AD75 4C 7B AD			JMP IO        			;SAVEN/LOAD
   619 AD78			NOEND	
   620 AD78 4C 3A AD			JMP LEVELWAL
   621 				;
   622 				; SPEICHERN.LADEN DES GEWAHLTEN LEVELS
   623 				;------------------------------------
   624 AD7B A9 3B		IO	LDA #<BLANKLST     		;BITTE
   625 AD7D 8D 30 02			STA 560           		;WARTEN
   626 AD80 A9 AA			LDA #>BLANKLST	 		;AUSGEBEN.
   627 AD82 8D 31 02			STA 561
   628 AD85 20 38 AE			JSR WAIT
   629 				;
   630 AD88 AD 08 AA			LDA COMMAND    			;INPUT OUTPUT?
   631 AD8B 8D 02 03			STA DCOMND
   632 AD8E AE 06 AA			LDX LEVEL
   633 AD91 CA				DEX
   634 AD92 BD 0A AA			LDA SEKTORL,X
   635 AD95 8D 0A 03			STA DAUX1
   636 AD98 BD 10 AA			LDA SEKTORH,X
   637 AD9B 8D 0B 03			STA DAUX2
   638 AD9E A9 50			LDA #<$B550
   639 ADA0 8D 04 03			STA DBUFLO
   640 ADA3 A9 B5			LDA #>$B550
   641 ADA5 8D 05 03			STA DBUFHI
   642 				;
   643 ADA8			SAVLEV	
   644 ADA8 20 53 E4			JSR DSKINV
   645 ADAB 20 9A AE			JSR ADCSEK
   646 ADAE 20 AF AE			JSR ADCBUFF
   647 ADB1 AD 07 AA			LDA SEKTOREN
   648 ADB4 C9 06			CMP #6
   649 ADB6 D0 F0			BNE SAVLEV
   650 				;
   651 				; ZEICHENSAETZE
   652 				;
   653 ADB8 A9 00			LDA #<$B000
   654 ADBA 8D 04 03			STA DBUFLO
   655 ADBD A9 B0			LDA #>$B000
   656 ADBF 8D 05 03			STA DBUFHI
   657 				;
   658 ADC2 A9 01			LDA #1 
   659 ADC4 8D 07 AA			STA SEKTOREN
   660 ADC7			CHARSET	
   661 ADC7 20 53 E4			JSR DSKINV
   662 ADCA 20 AF AE			JSR ADCBUFF
   663 ADCD 20 9A AE			JSR ADCSEK
   664 ADD0 AD 07 AA			LDA SEKTOREN
   665 ADD3 C9 14			CMP #20
   666 ADD5 D0 F0			BNE CHARSET
   667 				;
   668 ADD7 A9 17			LDA #<STATUS
   669 ADD9 8D 1D AA			STA RAM
   670 ADDC A9 A8			LDA #>STATUS
   671 ADDE 8D 1E AA			STA RAM+1
   672 ADE1 A9 01			LDA #1
   673 ADE3 8D 07 AA			STA SEKTOREN
   674 				;
   675 ADE6 A9 16			LDA #<DLIST    			;ALTEN BILD-
   676 ADE8 8D 30 02			STA 560        			;SCHIRM
   677 ADEB A9 AA			LDA #>DLIST 			;WIEDER
   678 ADED 8D 31 02			STA 561        			;EINSCALTEN.
   679 				;
   680 ADF0 20 38 AE			JSR WAIT
   681 ADF3 20 38 AE			JSR WAIT
   682 ADF6 4C 1A AB			JMP STICK
   683 				;
   684 				; OUTPUT DER X/Y POS CURSOR UND DES
   685 				; ORGINAL ZEICHENS UND DER LEVELNR.
   686 				;------------------------------------
   687 ADF9			OUTPUT	
   688 ADF9 AD F7 A9			LDA XPOS
   689 ADFC 0A				ASL           			;XPOS*2	
   690 ADFD 0A				ASL
   691 ADFE AA				TAX
   692 ADFF BD 93 A9			LDA NUMMER,X
   693 AE02 8D 2B A8			STA STATUS+20
   694 AE05 E8				INX
   695 AE06 BD 93 A9			LDA NUMMER,X
   696 AE09 8D 2C A8			STA STATUS+21
   697 				;
   698 AE0C AD F8 A9			LDA YPOS
   699 AE0F 0A				ASL           			;YPOS*2
   700 AE10 0A				ASL
   701 AE11 AA				TAX
   702 AE12 BD 93 A9			LDA NUMMER,X
   703 AE15 8D 39 A8			STA STATUS+34
   704 AE18 E8				INX
   705 AE19 BD 93 A9			LDA NUMMER,X
   706 AE1C 8D 3A A8			STA STATUS+35
   707 				;
   708 AE1F AD FB A9			LDA ORGINAL
   709 AE22 8D 1F A8			STA STATUS+8
   710 				;
   711 AE25 AD 06 AA			LDA LEVEL     			;LEVEL NR.
   712 AE28 0A				ASL
   713 AE29 AA				TAX
   714 AE2A BD 93 A9			LDA NUMMER,X
   715 AE2D 8D E9 A8			STA IOSCR+50
   716 AE30 E8				INX
   717 AE31 BD 93 A9			LDA NUMMER,X
   718 AE34 8D EA A8			STA IOSCR+51
   719 				;
   720 AE37 60				RTS	
   721 				;
   722 				; WAIT
   723 				;------------------------------------
   724 AE38			WAIT	
   725 AE38 A2 64			LDX #100
   726 AE3A A0 64		L1	LDY #100
   727 AE3C 88			L2	DEY
   728 AE3D D0 FD			BNE L2
   729 AE3F CA				DEX
   730 AE40 D0 F8			BNE L1
   731 AE42 60				RTS
   732 				;
   733 				; UNTERPROGRAMM PM GRAFIK EINLESEN
   734 				;------------------------------------
   735 AE43			READ	
   736 AE43 A2 00			LDX #0
   737 AE45 AC FA A9			LDY Y
   738 AE48 BD E5 A9		PL1	LDA OBJEKT,X
   739 AE4B 99 00 4E			STA PLAYER1,Y
   740 AE4E C8				INY
   741 AE4F E8				INX
   742 AE50 E0 04			CPX #4
   743 AE52 D0 F4			BNE PL1
   744 AE54 60				RTS 
   745 				;
   746 				; UNTERPROGRAMM PM GRAFIK LOESCHEN
   747 				;------------------------------------
   748 AE55			PMWEG	
   749 AE55 A2 00			LDX #0
   750 AE57			CLEAR	
   751 AE57 A9 00			LDA #0
   752 AE59 9D 00 4E			STA PLAYER1,X
   753 AE5C E8				INX
   754 AE5D E0 FF			CPX #255
   755 AE5F D0 F6			BNE CLEAR
   756 AE61 60				RTS
   757 				;
   758 				; UNTERPROGRAMM BRAMADR +40
   759 				;       ''         ''   -40
   760 				;       ''         ''   +1
   761 				;       ''         ''   -1
   762 				;------------------------------------
   763 AE62			ADC40	
   764 AE62 18				CLC
   765 AE63 A5 CF			LDA BRAMADRL
   766 AE65 69 28			ADC #40
   767 AE67 85 CF			STA BRAMADRL
   768 AE69 A5 D0			LDA BRAMADRH
   769 AE6B 69 00			ADC #0
   770 AE6D 85 D0			STA BRAMADRH
   771 AE6F 60				RTS
   772 				;
   773 AE70			SBC40	
   774 AE70 38				SEC
   775 AE71 A5 CF			LDA BRAMADRL
   776 AE73 E9 28			SBC #40
   777 AE75 85 CF			STA BRAMADRL
   778 AE77 A5 D0			LDA BRAMADRH
   779 AE79 E9 00			SBC #0
   780 AE7B 85 D0			STA BRAMADRH
   781 AE7D 60				RTS
   782 				;
   783 AE7E			ADC1	
   784 AE7E 18				CLC
   785 AE7F A5 CF			LDA BRAMADRL
   786 AE81 69 01			ADC #1
   787 AE83 85 CF			STA BRAMADRL
   788 AE85 A5 D0			LDA BRAMADRH
   789 AE87 69 00			ADC #0
   790 AE89 85 D0			STA BRAMADRH
   791 AE8B 60				RTS
   792 				;
   793 AE8C			SBC1	
   794 AE8C 38				SEC
   795 AE8D A5 CF			LDA BRAMADRL
   796 AE8F E9 01			SBC #1
   797 AE91 85 CF			STA BRAMADRL
   798 AE93 A5 D0			LDA BRAMADRH
   799 AE95 E9 00			SBC #0
   800 AE97 85 D0			STA BRAMADRH
   801 AE99 60				RTS	
   802 				;
   803 				; UNTERPROGRAMM SEKTOR+1
   804 				;------------------------------------
   805 AE9A			ADCSEK	
   806 AE9A 18				CLC
   807 AE9B AD 0A 03			LDA DAUX1
   808 AE9E 69 01			ADC #1
   809 AEA0 8D 0A 03			STA DAUX1
   810 AEA3 AD 0B 03			LDA DAUX2
   811 AEA6 69 00			ADC #0
   812 AEA8 8D 0B 03			STA DAUX2
   813 AEAB EE 07 AA			INC SEKTOREN
   814 AEAE 60				RTS
   815 				;
   816 				; UNTERPROGRAMM BUFFER+128
   817 				;------------------------------------
   818 AEAF			ADCBUFF	
   819 AEAF 18				CLC
   820 AEB0 AD 04 03			LDA DBUFLO
   821 AEB3 69 80			ADC #128
   822 AEB5 8D 04 03			STA DBUFLO
   823 AEB8 AD 05 03			LDA DBUFHI
   824 AEBB 69 00			ADC #0
   825 AEBD 8D 05 03			STA DBUFHI
   826 AEC0 60				RTS
   827 				;
   828 				; DISPLAY INTERUPT UNTERPROGRAMME
   829 				;
   830 				; -DLI1:TITELZEILE
   831 				; -DLI2:ZEICHENFELD
   832 				; -DLI3:STATUSZEILE
   833 				;-------------------------------------
   834 = D016			COLPF0	EQU $D016
   835 = D017			COLPF1	EQU $D017
   836 = D018			COLPF2	EQU $D018
   837 = D019			COLPF3	EQU $D019
   838 = D01A			COLPF4	EQU $D01A
   839 = D40B			VCOUNT	EQU $D40B
   840 = D40A			WSYNC	EQU $D40A
   841 = D409			ZEIGER	EQU $D409
   842 = 0200			DLIVKTL	EQU 512
   843 = 0201			DLIVKTH	EQU 513
   844 = B000			ZSATZ	EQU $B000
   845 				;
   846 				; DLI NO.1
   847 				;
   848 AEC1			DLI1	
   849 AEC1 48				PHA 
   850 AEC2 8D 0A D4			STA WSYNC
   851 AEC5 A9 0A			LDA #10
   852 AEC7 8D 18 D0			STA COLPF2	
   853 AECA A9 00			LDA #0
   854 AECC 8D 17 D0			STA COLPF1
   855 AECF 8D 1A D0			STA COLPF4
   856 AED2 A9 E0			LDA #224     			;ORGINAL CHARSET
   857 AED4 8D 09 D4			STA ZEIGER
   858 AED7 A9 E3			LDA #<DLI2  			;ZEIGER AUF NEUHE
   859 AED9 8D 00 02			STA DLIVKTL  			;ROTINE.
   860 AEDC A9 AE			LDA #>DLI2
   861 AEDE 8D 01 02			STA DLIVKTH
   862 AEE1 68				PLA         			;RETURN F.INTERUPT.
   863 AEE2 40				RTI
   864 				;
   865 				; DLI NO.2 (SCHWARZE LEERZEILE)
   866 				;
   867 AEE3			DLI2	
   868 AEE3 48				PHA
   869 AEE4 8D 0A D4			STA WSYNC
   870 AEE7 A9 00			LDA #0
   871 AEE9 8D 1A D0			STA COLPF4
   872 AEEC 8D 18 D0			STA COLPF2
   873 AEEF A9 FB			LDA #<DLI3
   874 AEF1 8D 00 02			STA DLIVKTL
   875 AEF4 A9 AE			LDA #>DLI3 
   876 AEF6 8D 01 02			STA DLIVKTH
   877 AEF9 68				PLA
   878 AEFA 40				RTI
   879 				;
   880 				; DLI NO.3 (2.ZEILE STATUSANZEIGE)
   881 				;
   882 AEFB			DLI3	
   883 AEFB 48				PHA
   884 AEFC 8D 0A D4			STA WSYNC
   885 AEFF A9 0A			LDA #10
   886 AF01 8D 18 D0			STA COLPF2
   887 AF04 A9 00			LDA #0
   888 AF06 8D 1A D0			STA COLPF4
   889 AF09 8D 17 D0			STA COLPF1
   890 AF0C A9 18			LDA #<DLI4
   891 AF0E 8D 00 02			STA DLIVKTL
   892 AF11 A9 AF			LDA #>DLI4
   893 AF13 8D 01 02			STA DLIVKTH
   894 AF16 68				PLA
   895 AF17 40				RTI	
   896 				;
   897 				; DLI NO.4 (SCHWARZE LEERZEILE)
   898 				;
   899 AF18			DLI4	
   900 AF18 48				PHA
   901 AF19 8D 0A D4			STA WSYNC
   902 AF1C A9 00			LDA #0
   903 AF1E 8D 1A D0			STA COLPF4
   904 AF21 8D 18 D0			STA COLPF2
   905 AF24 A9 30			LDA #<DLI5
   906 AF26 8D 00 02			STA DLIVKTL
   907 AF29 A9 AF			LDA #>DLI5
   908 AF2B 8D 01 02			STA DLIVKTH
   909 AF2E 68				PLA
   910 AF2F 40				RTI
   911 				; 
   912 				; DLI NO.5 (ARBEITSFLAECHE)
   913 				;
   914 AF30			DLI5	
   915 AF30 48				PHA
   916 AF31 8D 0A D4			STA WSYNC
   917 AF34 AD FC A9			LDA COLOR0
   918 AF37 8D 16 D0			STA COLPF0
   919 AF3A AD FD A9			LDA COLOR1
   920 AF3D 8D 17 D0			STA COLPF1
   921 AF40 AD FE A9			LDA COLOR2
   922 AF43 8D 18 D0			STA COLPF2
   923 AF46 AD FF A9			LDA COLOR3
   924 AF49 8D 19 D0			STA COLPF3	
   925 AF4C AD 00 AA			LDA COLOR4
   926 AF4F 8D 1A D0			STA COLPF4
   927 AF52 AD 09 AA			LDA CHAR
   928 AF55 8D 09 D4			STA ZEIGER
   929 AF58 A9 64			LDA #<DLI6
   930 AF5A 8D 00 02			STA DLIVKTL
   931 AF5D A9 AF			LDA #>DLI6
   932 AF5F 8D 01 02			STA DLIVKTH
   933 AF62 68				PLA
   934 AF63 40				RTI
   935 				;
   936 				; DLI NO.6 (UNTERER TEIL WORK AEREA)
   937 				;
   938 AF64			DLI6	
   939 AF64 48				PHA
   940 AF65 8D 0A D4			STA WSYNC
   941 AF68 A9 0A			LDA #10
   942 AF6A 8D 1A D0			STA COLPF4
   943 AF6D A9 79			LDA #<DLI7
   944 AF6F 8D 00 02			STA DLIVKTL
   945 AF72 A9 AF			LDA #>DLI7
   946 AF74 8D 01 02			STA DLIVKTH
   947 AF77 68				PLA
   948 AF78 40				RTI
   949 				;
   950 				; DLI NO.7 (ENDE WORK AREA)
   951 				;
   952 AF79			DLI7	
   953 AF79 48				PHA
   954 AF7A 8D 0A D4			STA WSYNC
   955 AF7D A9 00			LDA #0
   956 AF7F 8D 1A D0			STA COLPF4
   957 AF82 A9 C1			LDA #<DLI1
   958 AF84 8D 00 02			STA DLIVKTL
   959 AF87 A9 AE			LDA #>DLI1
   960 AF89 8D 01 02			STA DLIVKTH
   961 AF8C 68				PLA
   962 AF8D 40				RTI
