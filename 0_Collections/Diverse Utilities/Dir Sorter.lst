mads 1.9.3
     1 				; DIRSORTPROGRAMM
     2 				; (ZUM NEUORDNEN DES DIRECTORYS
     3 				;			   					BF'88
     4 				;-----------------------------------------
     5 				; Original:			1988
     6 				; †berarbeite: 		13.6.2014
     7 				; Original: 		EMEINE.ATR
     8 				; Original Source:	DIRSORT.SRC 
     9 				;-----------------------------------------
    10 				;
    11 				; DISK IO EQUATES
    12 				;
    13 = 0304			DBUFLO	EQU 772   			;BUFFER LOW 
    14 = 0305			DBUFHI	EQU 773   			;BUFFER HI
    15 = 030A			DAUX1	EQU 778   			;SEKTORNUMMER LOW
    16 = 030B			DAUX2	EQU 779   			;SEKTORNUMMER HI
    17 = 0302			DCOMND	EQU 770	 			;KOMMANDO
    18 = E453			DSKINV	EQU 58451 			;IO ROTINE
    19
    20 = 00CD			DIR		EQU 205   			;ZEIGER AUF DIR.
    21 = 00CF			BRAM	EQU 207   			;ZEIGER AUF BILDRAM.
    22 = 00CB			NDIR	EQU 203
    23 				;
    24 				; START
    25 				;
    26 					ORG $A800
    27 FFFF> A800-A938> 4C 25 + 	JMP START
    28
    29 A803 01			ANZAHL		.byte 1
    30 A804 01			ZEILE		.byte 1
    31 A805 10			ZEILE2		.byte 16
    32 A806 00			SEKTOREN	.byte 0
    33 A807 01			EINTRAG		.byte 1
    34 A808 00 00 00		BUFF		.byte 0,0,0
    35
    36 A80B 70			DLIST	.byte 112
    37 A80C 46					.byte 6+64
    38 A80D 35 A8				.word TITEL
    39 A80F 70					.byte 112
    40 A810 42					.byte 2+64
    41 A811 49 A8				.word WAHL
    42 A813 00					.byte 0
    43 A814 42					.byte 2+64
    44 A815 4D A9				.word SCREEN
    45 A817 02 02 02 02 02 02 + 		.byte 2,2,2,2,2,2,2,2,2,2,2,2
    46 A823 02 02 02 00				.byte 2,2,2,0
    47 A827 42					.byte 2+64
    48 A828 71 A8				.word MENUE
    49 A82A 00 02 00 02 00 02 + 		.byte 0,2,0,2,0,2,0,2,65
    50 A833 0B A8				.word DLIST 
    51 				;
    52 A835 00 00 00 00 00 00 + TITEL	.byte "      DIRSORTER     "
    53 A849 00 00 00 00 00 21 + WAHL	.byte "     Altes Dir.          Neues Dir.     "
    54 A871 33 34 29 23 2B 00 + MENUE	.byte "STICK AUF AB:Auswahl eines eintrages    "
    55
    56 A899 34 32 29 27 27 25 + 		.byte "TRIGGER     :Eintrag uebernehmen        "
    57 A8C1 2F 30 34 29 2F 2E + 		.byte "OPTION TASTE:Leerstelle einfuegen       "
    58 A8E9 33 34 21 32 34 00 + 		.byte "START TASTE :Neues Directory schreiben  "
    59 A911 33 25 2C 25 23 34 + 		.byte "SELECT TASTE:Dos                        "
    60
    61 A939			B		ORG *+20
    62 A94D			SCREEN	ORG *+1000
    63 AD35			SEKBUFF	ORG *+1200
    64 B1E5			TABELLE	ORG *+64
    65 				;
    66 				; START PROGRAMM.
    67 				; INIT
    68 				;
    69 B225			START 
    70 B225-B48F> A9 0B			LDA #<DLIST  		;DISPLAYLIST EIN.
    71 B227 8D 30 02			STA 560
    72 B22A A9 A8			LDA #>DLIST
    73 B22C 8D 31 02			STA 561
    74 				;
    75 B22F A9 01			LDA #1      		;PLAYER
    76 B231 8D 0D D0			STA 53261   		;ALS TRENNSTRICH
    77 B234 A9 79			LDA #121    		;DARSTELLEN
    78 B236 8D 00 D0			STA 53248
    79 				;
    80 B239 A9 4D			LDA #<SCREEN 		;BILDRAMADRESSE
    81 B23B 85 CF			STA BRAM      		;EINTRAGEN.
    82 B23D A9 A9			LDA #>SCREEN
    83 B23F 85 D0			STA BRAM+1
    84 B241 A9 25			LDA #<SEKBUFF-16 	;ZEIGER AUF
    85 B243 85 CD			STA DIR        		;DIRECTORY.
    86 B245 A9 9D			LDA #>SEKBUFF-16 
    87 B247 85 CE			STA DIR+1
    88 B249 A9 66			LDA #<NBUFF-16
    89 B24B 85 CB			STA NDIR
    90 B24D A9 A5			LDA #>NBUFF-16
    91 B24F 85 CC			STA NDIR+1
    92 B251 A0 02			LDY #2        		;PFEIL
    93 B253 A9 1D			LDA #$3D-32   		;AUSGEBEN.
    94 B255 91 CF			STA (BRAM),Y
    95 B257 C8				INY
    96 B258 A9 1E			LDA #$3E-32
    97 B25A 91 CF			STA (BRAM),Y
    98 				;
    99 B25C A2 00			LDX #0
   100 B25E			FILL	
   101 B25E A9 2E			LDA #'.'
   102 B260 9D 35 AD			STA SEKBUFF,X
   103 B263 9D 90 B4			STA BLKBUFF,X
   104 B266 E8				INX
   105 B267 D0 F5			BNE FILL
   106 B269 A2 00			LDX #0
   107 B26B			FILL2	
   108 B26B 9D 34 AE			STA SEKBUFF+255,X
   109 B26E 9D 8F B5			STA BLKBUFF+255,X
   110 B271 E8				INX
   111 B272 D0 F7			BNE FILL2	
   112 B274 A2 00			LDX #0
   113 B276 A9 00		CLEAR	LDA #0
   114 B278 9D E5 B1			STA TABELLE,X
   115 B27B E8				INX
   116 B27C E0 40			CPX #64
   117 B27E D0 F6			BNE CLEAR	
   118 				;
   119 B280 20 92 B3			JSR READDIR
   120 B283 20 F0 B3			JSR BREENTR   	;ADR BERECHNEN
   121 B286 20 08 B4			JSR OUTCHR    	;AUSGABE
   122 				;
   123 				; MAINPRG.
   124 				; -ABFRAGE DER TASTATUR
   125 				; -NEUORDNEN DES DIRS
   126 				;
   127 B289			STICK	
   128 B289 AD 78 02			LDA 632
   129 B28C C9 0E			CMP #14
   130 B28E D0 06			BNE NOT14
   131 B290 20 BD B2			JSR SCRUP
   132 B293 4C 89 B2			JMP STICK
   133 B296			NOT14	
   134 B296 C9 0D			CMP #13
   135 B298 D0 03			BNE NOT13
   136 B29A 20 D7 B2			JSR SCRDWN
   137 B29D			NOT13	
   138 B29D AD 84 02			LDA 644
   139 B2A0 C9 00			CMP #0
   140 B2A2 D0 09			BNE NOT0
   141 B2A4 20 F2 B2			JSR COPY
   142 B2A7 20 87 B4			JSR WAIT
   143 B2AA 4C 89 B2			JMP STICK
   144 B2AD			NOT0	
   145 B2AD AD 1F D0			LDA 53279
   146 B2B0 C9 06			CMP #6
   147 B2B2 D0 06			BNE NOT4
   148 B2B4 20 C1 B3			JSR SAVE
   149 B2B7 20 87 B4			JSR WAIT
   150 B2BA			NOT4	
   151 B2BA 4C 89 B2			JMP STICK
   152 				;
   153 				; SCROLL DIR UP
   154 				;
   155 B2BD			SCRUP	
   156 B2BD AD 04 A8			LDA ZEILE
   157 B2C0 C9 40			CMP #64
   158 B2C2 D0 03			BNE NOT64
   159 B2C4 4C 89 B2			JMP STICK
   160
   161 B2C7			NOT64	
   162 B2C7 EE 04 A8			INC ZEILE
   163 B2CA EE 07 A8			INC EINTRAG
   164 B2CD 20 F0 B3			JSR BREENTR
   165 B2D0 20 08 B4			JSR OUTCHR
   166 B2D3 20 87 B4			JSR WAIT
   167 B2D6 60				RTS
   168 				;
   169 				; SCROLL DIR DOWN
   170 				;
   171 B2D7			SCRDWN	
   172 B2D7 AD 04 A8			LDA ZEILE
   173 B2DA C9 01			CMP #1
   174 B2DC D0 03			BNE NOT1
   175 B2DE 4C 89 B2			JMP STICK
   176 				;
   177 B2E1			NOT1	
   178 B2E1 CE 04 A8			DEC ZEILE
   179 B2E4 CE 07 A8			DEC EINTRAG
   180 B2E7 20 F0 B3			JSR BREENTR
   181 B2EA 20 08 B4			JSR OUTCHR
   182 B2ED 20 87 B4			JSR WAIT
   183 B2F0 60				RTS
   184 				;
   185 				; LEERZEILE EINFUEGEN
   186 				;
   187 B2F1			BLANK	
   188 B2F1 60				RTS
   189 				;
   190 				; UEBERNAHME EINES EINTRAGES
   191 				;
   192 B2F2			COPY	
   193 B2F2 AE 07 A8			LDX EINTRAG   		;PRUEFEN
   194 B2F5 BD E5 B1			LDA TABELLE,X 		;OB EINTRAG 
   195 B2F8 C9 01			CMP #1        		;SCHON IN
   196 B2FA D0 0E			BNE NOTUSED   		;DAS NEUE DIR
   197 B2FC A9 37			LDA #55       		;UEBERNOMMEN
   198 B2FE 8D C8 02			STA 712       		;WURDE.
   199 B301 20 87 B4			JSR WAIT      		;WENN JA RAND
   200 B304 A9 00			LDA #0        		;BLINKEN LASSEN
   201 B306 8D C8 02			STA 712       		;UND RTS.
   202 B309 60				RTS
   203 				;
   204 B30A			NOTUSED	
   205 B30A 20 F0 B3			JSR BREENTR 		;ADR BERECHNEN
   206 B30D A0 00			LDY #0
   207 B30F			COPYLOP	
   208 B30F B1 CD			LDA (DIR),Y
   209 B311 91 CB			STA (NDIR),Y
   210 B313 C8				INY
   211 B314 C0 10			CPY #16
   212 B316 D0 F7			BNE COPYLOP
   213 				;
   214 B318 18				CLC
   215 B319 A5 CF			LDA BRAM
   216 B31B 69 14			ADC #20
   217 B31D 85 CF			STA BRAM
   218 B31F A5 D0			LDA BRAM+1
   219 B321 69 00			ADC #0
   220 B323 85 D0			STA BRAM+1
   221 B325 A5 CD			LDA DIR
   222 B327 8D 08 A8			STA BUFF
   223 B32A A5 CE			LDA DIR+1
   224 B32C 8D 09 A8			STA BUFF+1
   225 B32F AD 04 A8			LDA ZEILE
   226 B332 8D 0A A8			STA BUFF+2
   227 B335 AD 05 A8			LDA ZEILE2
   228 B338 8D 04 A8			STA ZEILE
   229 B33B 38				SEC
   230 B33C A5 CB			LDA NDIR
   231 B33E E9 F0			SBC #240
   232 B340 85 CD			STA DIR
   233 B342 A5 CC			LDA NDIR+1
   234 B344 E9 00			SBC #0
   235 B346 85 CE			STA DIR+1
   236 B348 CE 04 A8			DEC ZEILE
   237 				;	JSR BREENTR
   238 B34B 20 08 B4			JSR OUTCHR
   239 B34E 18				CLC
   240 B34F A5 CB			LDA NDIR
   241 B351 69 10			ADC #16
   242 B353 85 CB			STA NDIR
   243 B355 A5 CC			LDA NDIR+1
   244 B357 69 00			ADC #0
   245 B359 85 CC			STA NDIR+1
   246 B35B AD 08 A8			LDA BUFF
   247 B35E 85 CD			STA DIR
   248 B360 AD 09 A8			LDA BUFF+1
   249 B363 85 CE			STA DIR+1
   250 B365 AD 04 A8			LDA ZEILE
   251 B368 8D 05 A8			STA ZEILE2
   252 B36B AD 0A A8			LDA BUFF+2
   253 B36E 8D 04 A8			STA ZEILE
   254 B371 A9 4D			LDA #<SCREEN
   255 B373 85 CF			STA BRAM
   256 B375 A9 A9			LDA #>SCREEN
   257 B377 85 D0			STA BRAM+1
   258 				;	
   259 B379 A0 05			LDY #5
   260 B37B			INVERT	
   261 B37B B1 CD			LDA (DIR),Y 			;AUSGEWAEHLTEN
   262 B37D 09 80			ORA #128    			;EINTRAG 
   263 B37F 91 CD			STA (DIR),Y 			;INVERTIEREN.
   264 B381 C8				INY
   265 B382 C0 10			CPY #16
   266 B384 D0 F5			BNE INVERT
   267 B386 20 08 B4			JSR OUTCHR  			;AUSGABE
   268 B389 AE 07 A8			LDX EINTRAG
   269 B38C A9 01			LDA #1        			;KENNZEICHENUNG
   270 B38E 9D E5 B1			STA TABELLE,X 			;FUER UEBERNAME.
   271 B391 60				RTS
   272 				;
   273 				; SUBROTINES
   274 				;
   275 				; LESE DIRECTORY
   276 				;
   277 B392			READDIR	
   278 B392 A9 00			LDA #0
   279 B394 8D 06 A8			STA SEKTOREN
   280 B397 A9 69			LDA #<361
   281 B399 8D 0A 03			STA DAUX1
   282 B39C A9 01			LDA #>361
   283 B39E 8D 0B 03			STA DAUX2
   284 B3A1 A9 35			LDA #<SEKBUFF
   285 B3A3 8D 04 03			STA DBUFLO
   286 B3A6 A9 AD			LDA #>SEKBUFF
   287 B3A8 8D 05 03			STA DBUFHI
   288 B3AB A9 52			LDA #'R'
   289 B3AD 8D 02 03			STA DCOMND
   290 B3B0			LESE	
   291 B3B0 20 53 E4			JSR DSKINV
   292 B3B3 20 75 B4			JSR BUFFER
   293 B3B6 20 60 B4			JSR SEKTOR
   294 B3B9 AD 06 A8			LDA SEKTOREN
   295 B3BC C9 04			CMP #4
   296 B3BE D0 F0			BNE LESE
   297 B3C0 60				RTS
   298 				;
   299 				; NEUES DIRECTORY SCHREIBEN
   300 				;
   301 B3C1			SAVE	
   302 B3C1 A9 69			LDA #<361
   303 B3C3 8D 0A 03			STA DAUX1
   304 B3C6 A9 01			LDA #>361
   305 B3C8 8D 0B 03			STA DAUX2
   306 B3CB A9 76			LDA #<NBUFF
   307 B3CD 8D 04 03			STA DBUFLO
   308 B3D0 A9 B5			LDA #>NBUFF
   309 B3D2 8D 05 03			STA DBUFHI
   310 B3D5 A9 57			LDA #'W'
   311 B3D7 8D 02 03			STA DCOMND
   312 B3DA A9 01			LDA #1
   313 B3DC 8D 06 A8			STA SEKTOREN
   314 B3DF			SAVELOP	
   315 B3DF 20 53 E4			JSR DSKINV
   316 B3E2 20 75 B4			JSR BUFFER
   317 B3E5 20 60 B4			JSR SEKTOR
   318 B3E8 AD 06 A8			LDA SEKTOREN
   319 B3EB C9 04			CMP #4
   320 B3ED D0 F0			BNE SAVELOP
   321 B3EF 60				RTS
   322 				;
   323 				; ADRESSE EINES DIREINTRAGES IM
   324 				; BUFFER ERRECNHEN
   325 				;
   326 B3F0			BREENTR	
   327 B3F0 A2 00			LDX #0
   328 B3F2			NEXTENTR	
   329 B3F2 A0 05			LDY #5      			;ZEILE*16
   330 B3F4 18				CLC
   331 B3F5 A5 CD			LDA DIR
   332 B3F7 69 10			ADC #16
   333 B3F9 85 CD			STA DIR
   334 B3FB A5 CE			LDA DIR+1
   335 B3FD 69 00			ADC #0
   336 B3FF 85 CE			STA DIR+1
   337 B401 E8				INX
   338 B402 EC 04 A8			CPX ZEILE
   339 B405 D0 EB			BNE NEXTENTR
   340 B407 60				RTS
   341 				;
   342 				; AUSGABE DES DIRECTORYS AUF DEM 
   343 				; BILDSCHIRM
   344 				;
   345 B408			OUTCHR	
   346 B408 A0 00			LDY #0      			;PRUEFEN OB 
   347 B40A B1 CD			LDA (DIR),Y 			;EINTRAG GELOESCHT
   348 B40C C9 80			CMP #128    			;ODER DIR 
   349 B40E D0 03			BNE OUTOK   			;ZUE ENDE IST.
   350 B410 4C 21 B4			JMP NOUT	
   351 				;
   352 B413			OUTOK	
   353 B413 A0 05			LDY #5
   354 B415			OUTPUT	
   355 B415 38				SEC          			;15 ZEILEN
   356 B416 B1 CD			LDA (DIR),Y  			;AB ANZAHL*16
   357 B418 E9 20			SBC #32      			;AUSGEBEN.
   358 B41A 91 CF			STA (BRAM),Y
   359 B41C C8				INY
   360 B41D C0 10			CPY #16
   361 B41F D0 F4			BNE OUTPUT
   362 				;
   363 B421			NOUT	
   364 B421 AD 03 A8			LDA ANZAHL  			;FERTIG ?
   365 B424 C9 10			CMP #16
   366 B426 D0 16			BNE NOTEND
   367 				;
   368 				; ENDE AUSGABE
   369 				;
   370 B428 A9 4D			LDA #<SCREEN			;BILDRAMADRESSE
   371 B42A 85 CF			STA BRAM	     		;ZUREUCKSETZEN.
   372 B42C A9 A9			LDA #>SCREEN
   373 B42E 85 D0			STA BRAM+1
   374 B430 A9 35			LDA #<SEKBUFF 			;ZEIGER AUF
   375 B432 85 CD			STA DIR	      			;DIR.	
   376 B434 A9 AD			LDA #>SEKBUFF 			;ZUREUCK-
   377 B436 85 CE			STA DIR+1      			;SETZEN
   378 B438 A9 01			LDA #1
   379 B43A 8D 03 A8			STA ANZAHL
   380 B43D 60				RTS	     				;RETURN.
   381 				;
   382 B43E			NOTEND	
   383 B43E 18				CLC         			;BILDRAM+40
   384 B43F A5 CF			LDA BRAM
   385 B441 69 28			ADC #40
   386 B443 85 CF			STA BRAM
   387 B445 A5 D0			LDA BRAM+1
   388 B447 69 00			ADC #0
   389 B449 85 D0			STA BRAM+1
   390 B44B EE 03 A8			INC ANZAHL
   391 B44E A0 05			LDY #5
   392 B450 18				CLC
   393 B451 A5 CD			LDA DIR  				; ZEIGER AUF DIR+16
   394 B453 69 10			ADC #16
   395 B455 85 CD			STA DIR
   396 B457 A5 CE			LDA DIR+1
   397 B459 69 00			ADC #0
   398 B45B 85 CE			STA DIR+1
   399 B45D 4C 15 B4			JMP OUTPUT 				;NAECHSTER->
   400 				;
   401 				; SUBROTINE SEKTOREN ERHOHEN
   402 				;
   403 B460			SEKTOR	
   404 B460 18				CLC
   405 B461 AD 0A 03			LDA DAUX1
   406 B464 69 01			ADC #1
   407 B466 8D 0A 03			STA DAUX1
   408 B469 AD 0B 03			LDA DAUX2
   409 B46C 69 00			ADC #0
   410 B46E 8D 0B 03			STA DAUX2
   411 B471 EE 06 A8			INC SEKTOREN
   412 B474 60				RTS
   413 				;
   414 				; SUBROTINE BUFFER+125
   415 				;
   416 B475			BUFFER	
   417 B475 18				CLC
   418 B476 AD 04 03			LDA DBUFLO
   419 B479 69 80			ADC #128
   420 B47B 8D 04 03			STA DBUFLO
   421 B47E AD 05 03			LDA DBUFHI
   422 B481 69 00			ADC #0
   423 B483 8D 05 03			STA DBUFHI
   424 B486 60				RTS
   425 				;
   426 				; WARTESCHLEIFE
   427 				;
   428 B487			WAIT	
   429 B487 A9 FA			LDA #250
   430 B489 85 14			STA $14
   431 B48B			LOOP
   432 B48B A5 14			LDA $14
   433 B48D D0 FC			BNE LOOP
   434 B48F 60				RTS
   435 B490			BLKBUFF	
   436 B490				ORG *+230
   437 B576			NBUFF	
   438 B576				ORG *+1000
